<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">
    <title>지역별 작목정보</title>
</head>
<body>
    <button id = "find-me">Show my location</button><br/>
    <p id = "status"></p>

    <div class="hAddr">
        <span class="title">지도중심기준 행정동 주소정보</span>
        <span id="currentAddr"></span>
    </div>

    <select id="sidoCdResearch" name="sidoCdResearch" onchange="setMiddleSidoCd('sidoCdResearch')" title="시도 선택">
        <option value="" selected="selected">시도선택</option>
        <option value="6420000">강원도</option>
        <option value="6410000">경기도</option>
        <option value="6480000">경상남도</option>
        <option value="6470000">경상북도</option>
        <option value="6290000">광주광역시</option>
        <option value="6270000">대구광역시</option>
        <option value="6300000">대전광역시</option>
        <option value="6260000">부산광역시</option>
        <option value="6110000">서울특별시</option>
        <option value="5690000">세종특별자치시</option>
        <option value="6310000">울산광역시</option>
        <option value="6280000">인천광역시</option>
        <option value="6460000">전라남도</option>
        <option value="6450000">전라북도</option>
        <option value="6500000">제주특별자치도</option>
        <option value="6440000">충청남도</option>
        <option value="6430000">충청북도</option>
    </select>

    <select id="sigunCdResearch" name="sigunCdResearch" onchange="setSigun('sigunCdResearch');" title="시군구 선택">
        <option value="" selected="selected">시군구선택</option>
    </select>

    <div id="mainHide">
        <table class="table table-hover">
            <thead>
            <tr>
                <th class="col-md-1">시도</th>
                <th class="col-md-1">시군구</th>
                <th class="col-md-1">품목</th>
                <th class="col-md-1">부부 가족경영 규모</th>
                <th class="col-md-1">평균투자비(3년합계)</th>
                <th class="col-md-1">연간운영비/년(운영)</th>
                <th class="col-md-1">평균수입/년(부부인건비 포함)</th>
                <th class="col-md-1">평균농지가격(3.3㎡)</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="shipping : ${shippingAreaList}">
                <td th:text="${shipping.province}"></td>
                <td th:text="${shipping.city}"></td>
                <td th:text="${shipping.item}"></td>
                <td th:text="${shipping.family_management_scale}"></td>
                <td th:text="${shipping.average_investment_cost}"></td>
                <td th:text="${shipping.annual_operating_cost}"></td>
                <td th:text="${shipping.average_income}"></td>
                <td th:text="${shipping.average_farmland_price}"></td>
            </tr>
            </tbody>
        </table>
    </div>


<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7c2ea6cdea824e6159caeae6cc70ec39&libraries=services"></script>
<script>
    var geocoder = new kakao.maps.services.Geocoder();
    var latitude;
    var longitude;

    //현재 좌표 얻기
    function getLatLng() {
        var status = document.querySelector('#status');

        function success(position) {
            latitude  = position.coords.latitude;
            longitude = position.coords.longitude;

            status.textContent = 'Latitude: '+ latitude + ' °, Longitude: ' + longitude+' °';
        }

        function error() {
            status.textContent = 'Unable to retrieve your location';
        }

        if(!navigator.geolocation) {
            status.textContent = 'Geolocation is not supported by your browser';
        } else {
            status.textContent = 'Locating…';
            navigator.geolocation.getCurrentPosition(success, error);
        }

        var latlng = new kakao.maps.LatLng(latitude, longitude);
        searchAddrFromCoords( latlng, displayCurrentInfo);
    }


    function searchAddrFromCoords(latlng, callback){
        //좌표로 행정동 주소 정보 요청
        geocoder.coord2RegionCode(latlng.getLng(), latlng.getLat(),  callback);
    }


    //현재좌표에 대한 주소정보를 표출하는 함수입니다
    function displayCurrentInfo(result, status) {
        if (status === kakao.maps.services.Status.OK) {
            var infoDiv = document.getElementById('currentAddr');
            var sidoSel = document.getElementById('sidoCdResearch');

            for(var i = 0; i < result.length; i++) {
                // 행정동의 region_type 값은 'H' 이므로
                if (result[i].region_type === 'H') {
                    //console.log(result[i]);
                    var result = result[i].address_name.split(" ");
                    infoDiv.innerHTML = result[0]+" "+result[1];
                    //sido select에 해당 태그가 select되게
                    break;
                }
            }
        }
    }

    document.querySelector('#find-me').addEventListener('click', getLatLng);
</script>
</body>
</html>